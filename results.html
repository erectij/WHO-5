<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WHO-5 Live Results</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
<script type="module">
if(prompt('Password?')!=='mammabird'){document.body.innerHTML='<h2>Access denied</h2>';throw'';}

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getDatabase, onValue, ref } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

const cfg={
 apiKey:"YOUR-API-KEY",
 authDomain:"YOUR-PROJECT.firebaseapp.com",
 databaseURL:"https://YOUR-PROJECT.firebaseio.com",
 projectId:"YOUR-PROJECT",
 storageBucket:"YOUR-PROJECT.appspot.com",
 messagingSenderId:"SENDER-ID",
 appId:"APP-ID"
};
const app=initializeApp(cfg), db=getDatabase(app);

const ctx=document.getElementById('hist').getContext('2d');
const bins=[...Array(11)].map((_,i)=>i*10);      //0-100, 10-pt bins
const data=new Array(10).fill(0);
const chart=new Chart(ctx,{type:'bar',data:{labels:bins.slice(0,-1).map(b=>`${b}-${b+9}`),datasets:[{data}]},
  options:{animation:false,scales:{y:{beginAtZero:true,stepSize:1}}}});

const meanEl=document.getElementById('mean');

onValue(ref(db,'scores'),snap=>{
 const scores=[];
 snap.forEach(child=>scores.push(child.val()));
 if(scores.length===0)return;
 //histogram counts
 data.fill(0);
 scores.forEach(s=>{
   const idx=Math.min(Math.floor(s/10),9);
   data[idx]++
 });
 chart.update();
 //mean
 const mean=Math.round(scores.reduce((a,b)=>a+b)/scores.length);
 meanEl.textContent=`Mean WHO-5: ${mean}`;
});
</script>
</head>
<body class="container">
<h1>Live WHO-5 Scores</h1>
<h2 id="mean">Mean WHO-5: â€¦</h2>
<canvas id="hist" height="280"></canvas>
<p>Total respondents: <span id="n"></span></p>
</body>
</html>
