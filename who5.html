<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WHO-5 Questionnaire</title>
<!-- Minimal styling via PicoCSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
<style>
/* hide native radios, style labels as buttons */
input[type=radio]{display:none}
.choice{
  display:inline-block;margin:0.25rem 0.15rem;padding:0.4rem 0.6rem;
  border:1px solid #bbb;border-radius:4px;cursor:pointer;
  user-select:none;transition:background 0.1s;
}
input[type=radio]:checked + label.choice{
  background:#0077c2;color:#fff;font-weight:600;border-color:#0077c2;
}
.score{font-size:1.25rem;font-weight:700}
fieldset{border:none;margin:0 0 1.2rem;padding:0}
legend{font-weight:600}
.error{color:red;font-weight:bold;margin-top:1rem}
.success{color:green;font-weight:bold;margin-top:1rem}
#status{margin-top:1rem}
</style>
</head>
<body class="container">
<h1>WHO-5 Well-Being Index</h1>
<form id="form">
<nav>
  <button type="submit">Submit</button>
  <button type="button" id="clearBtn">Clear</button>
  <span id="top" class="score"></span>
</nav>
<!-- Questions will be inserted here by JavaScript -->
<div id="questions-container"></div>
<p id="bot" class="score"></p>
<div id="status"></div>
</form>

<!-- Firebase + logic -->
<script type="module">
import { initializeApp }            from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getDatabase, push, ref }   from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
/* --- your Firebase project --- */
const firebaseConfig={
  apiKey:"AIzaSyC6aUW6S7rlVbedhsRIxuoS9MIhEbgIVXo",
  authDomain:"who-5-test.firebaseapp.com",
  databaseURL:"https://who-5-test-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"who-5-test",
  storageBucket:"who-5-test.appspot.com",
  messagingSenderId:"934691632402",
  appId:"1:934691632402:web:925f243dffa4b97cf86fcb"
};

// Display status messages
function showStatus(message, isError = false) {
  const statusEl = document.getElementById('status');
  statusEl.innerHTML = '';
  const messageEl = document.createElement('p');
  messageEl.textContent = message;
  messageEl.className = isError ? 'error' : 'success';
  statusEl.appendChild(messageEl);
}

try {
  console.log("Initializing Firebase...");
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  console.log("Firebase initialized successfully");

  /* --- helpers --- */
  function clearForm(){
    document.getElementById('form').reset();
    document.getElementById('top').textContent = '';
    document.getElementById('bot').textContent = '';
    document.getElementById('status').innerHTML = '';
  }

  function submitForm(e){
    e.preventDefault();
    const values=[1,2,3,4,5].map(i=>{
      const sel=document.querySelector(`input[name=q${i}]:checked`);
      return sel ? Number(sel.value) : null;
    });
    
    console.log("Form values:", values);
    
    if(values.includes(null)){
      alert('Please answer all five items');
      return;
    }
    
    const score = values.reduce((a,b)=>a+b)*4;
    console.log("Calculated score:", score);
    
    document.getElementById('top').textContent = `Your WHO-5 score: ${score}`;
    document.getElementById('bot').textContent = `Your WHO-5 score: ${score}`;
    
    // Add loading indicator
    showStatus("Submitting score...");
    
    // Push to Firebase with error handling
    push(ref(db,'scores'), score)
      .then(() => {
        console.log("Successfully submitted score to Firebase:", score);
        showStatus("Your score has been successfully submitted!");
      })
      .catch((error) => {
        console.error("Error submitting score to Firebase:", error);
        showStatus("Error submitting score: " + error.message, true);
      });
  }

  // Questions and labels
  const questions = [
    'I have felt cheerful and in good spirits',
    'I have felt calm and relaxed',
    'I have felt active and vigorous',
    'I woke up feeling fresh and rested',
    'My daily life has been filled with things that interest me'
  ];

  const labels = {
    5: 'All of the time',
    4: 'Most of the time',
    3: 'More than half of the time',
    2: 'Less than half of the time',
    1: 'Some of the time',
    0: 'At no time'
  };

  // Generate questions using proper DOM methods
  function generateQuestions() {
    const container = document.getElementById('questions-container');
    
    questions.forEach((text, i) => {
      const fieldset = document.createElement('fieldset');
      const legend = document.createElement('legend');
      legend.textContent = text;
      fieldset.appendChild(legend);
      
      [5, 4, 3, 2, 1, 0].forEach(v => {
        const input = document.createElement('input');
        input.type = 'radio';
        input.id = `q${i+1}_${v}`;
        input.name = `q${i+1}`;
        input.value = v;
        
        const label = document.createElement('label');
        label.setAttribute('for', `q${i+1}_${v}`);
        label.className = 'choice';
        label.textContent = labels[v];
        
        fieldset.appendChild(input);
        fieldset.appendChild(label);
      });
      
      container.appendChild(fieldset);
    });
  }

  // Set up event listeners
  document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM loaded, generating questions");
    generateQuestions();
    document.getElementById('form').addEventListener('submit', submitForm);
    document.getElementById('clearBtn').addEventListener('click', clearForm);
  });
} catch (error) {
  console.error("Error initializing the application:", error);
  showStatus("Error initializing the application: " + error.message, true);
}
</script>
</body>
</html>
